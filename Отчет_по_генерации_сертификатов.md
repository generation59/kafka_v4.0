# Отчет по генерации SSL-сертификатов для кластера Kafka

## 1. Описание процесса

Для обеспечения защищенного соединения между брокерами Kafka и клиентами используется SSL/TLS. Сертификаты генерируются с помощью OpenSSL и утилиты keytool (JDK).

Процесс включает:
- Генерацию корневого сертификата (CA)
- Генерацию приватных ключей и сертификатов для каждого брокера
- Формирование keystore и truststore в формате JKS
- Использование конфигурационного файла `.cnf` для корректного формирования расширений сертификата (SAN)

## 2. Используемые файлы

- **Скрипт генерации:** `src/utils/ssl_generator.py`
- **Конфиг для openssl:** `infra/docker-compose/ssl/config/kafka_broker.cnf`
- **Папка для сертификатов:** `infra/docker-compose/ssl/certificates`

### Пример содержимого kafka_broker.cnf
```ini
[ policy_match ]
countryName = match
stateOrProvinceName = match
organizationName = match
organizationalUnitName = optional
commonName = supplied
emailAddress = optional


[ req ]
prompt = no
distinguished_name = dn
default_md = sha256
default_bits = 4096
x509_extensions = v3_ca


[ dn ]
countryName = RU
organizationName = Yandex
organizationalUnitName = Practice
localityName = Moscow
commonName = yandex-practice-kafka-ca


[ v3_ca ]
subjectKeyIdentifier=hash
basicConstraints = critical,CA:true
authorityKeyIdentifier = keyid:always,issuer:always
keyUsage = critical,keyCertSign,cRLSign
```

## 3. Инструкция по запуску

1. Убедитесь, что установлены OpenSSL и keytool.
2. Проверьте наличие файла `infra/docker-compose/ssl/config/kafka_broker.cnf`.
3. Запустите генерацию сертификатов:

```bash
python src/utils/ssl_generator.py
```

В результате будут созданы файлы:
- ca-cert.pem, ca-key.pem
- kafka-0.jks, kafka-1.jks, kafka-2.jks
- truststore.jks

## 4. Типовые ошибки и их устранение

- **Нет файла .cnf:**
  - Сертификаты будут сгенерированы без расширений SAN, что может привести к ошибкам SSL (например, hostname mismatch).
  - Решение: создать файл `kafka_broker.cnf` по примеру выше.
- **Нет openssl или keytool:**
  - Установите необходимые утилиты (OpenSSL, JDK).
- **Неправильные пути к сертификатам в docker-compose:**
  - Проверьте, что все пути в `docker-compose.yml` совпадают с местоположением файлов.

## 5. Порядок запуска кластера

1. Сначала сгенерируйте сертификаты.
2. Затем запускайте кластер командой:
```bash
cd infra/docker-compose
docker-compose up -d
```

---

**Документ подготовлен для проекта Kafka Cluster Management.** 